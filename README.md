# wca-333fm-stats.jl

WCA (World Cube Association) 三阶最少步 (333fm) 统计数据分析和可视化工具。

## 功能特性

- 📊 **统计分析**：计算各种统计指标（最佳成绩、平均成绩、单次成绩等）
- 🏆 **排名系统**：所有数值列都有对应的全球排名和国家排名
- 📈 **滚动平均**：MO3/5/12/50/100, AO5/12/50/100
- 🎯 **奖牌统计**：金/银/铜牌统计
- 🌐 **Web 前端**：美观的数据可视化界面
- 📁 **多文件支持**：可在三个数据文件之间切换查看
- 🔧 **列选择器**：自定义显示哪些列，按类别组织
- 💾 **数据持久化**：自动保存用户的列选择和文件选择

## 使用方法

### 1. 生成统计数据

运行 Julia 脚本生成 CSV 文件：

```bash
julia -e 'include("WCAStats.jl"); WCAStats.__init__()' source <WCA_export_file.zip>
```

生成的 CSV 文件：
- `results.csv` - 完整统计数据
- `results.top100.csv` - 全球 Top 100
- `results.china.top30.csv` - 中国 Top 30

### 2. 查看前端页面

1. 确保已生成至少一个 CSV 文件（`results.csv`、`results.top100.csv` 或 `results.china.top30.csv`）
2. 在浏览器中打开 `index.html` 文件
   - 可以直接双击打开（某些浏览器可能限制本地文件访问）
   - 或者使用本地服务器（推荐）：
     ```bash
     # Python 3
     python -m http.server 8000
     
     # 或使用 Node.js
     npx http-server
     ```
3. 访问 `http://localhost:8000` 查看页面

## 前端功能

### 数据展示
- 📊 **统计摘要**：总选手数、平均最佳成绩、平均成绩、总比赛次数
- 📋 **数据表格**：详细的选手统计数据，支持自定义列显示
- 🏅 **奖牌展示**：金/银/铜牌数量
- 📁 **多文件切换**：可在三个数据文件之间切换
  - 中国 Top 30 (`results.china.top30.csv`)
  - 全球 Top 100 (`results.top100.csv`)
  - 完整数据 (`results.csv`)

### 交互功能
- 🔍 **搜索**：按姓名搜索选手
- 📊 **排序**：点击表头或使用下拉菜单排序，支持所有列
- 📄 **分页**：每页显示 30 条记录
- 🔧 **列选择器**：
  - 按类别组织列（基本信息、比赛统计、最佳成绩、平均成绩、单次成绩、滚动平均、奖牌、排名等）
  - 每个分组提供全选/全不选按钮
  - 支持显示/隐藏任意列
  - 每个文件的列选择设置独立保存
- 💾 **数据持久化**：
  - 自动保存文件选择
  - 自动保存每个文件的列选择设置
  - 下次打开页面时自动恢复
- 📱 **响应式设计**：支持移动设备

### 列分类
- **基本信息**：姓名、ID、国家、性别
- **比赛统计**：比赛次数、轮次、机会数、尝试次数
- **最佳成绩**：最佳成绩及其各种统计指标
- **平均成绩**：平均成绩及其各种统计指标
- **单次成绩**：单次成绩及其各种统计指标
- **滚动平均 - MO**：MO3/5/12/50/100 的最后和最佳值
- **滚动平均 - AO**：AO5/12/50/100 的最后和最佳值
- **奖牌**：金/银/铜牌数量
- **全球排名**：所有数值列的全球排名（`*_rank`）
- **国家排名**：所有数值列的国家排名（`*_nr`）
- **其他**：平均项统计

## 数据字段说明

### 基本统计
- `best` - 最佳成绩
- `average` - 平均成绩
- `solved_mean` - 单次平均成绩
- `competitions` - 比赛次数
- `rounds` - 轮次
- `solved_count` - 成功次数
- `chances` - 机会数
- `attempts` - 尝试次数

### 排名系统
**所有数值列都有对应的排名列**：
- `*_rank` - 全球排名（Global Rank）
- `*_nr` - 国家排名（National Rank）

例如：
- `best` → `best_rank`（全球排名）、`best_nr`（国家排名）
- `average` → `average_rank`（全球排名）、`average_nr`（国家排名）
- `solved_mean` → `solved_mean_rank`（全球排名）、`solved_mean_nr`（国家排名）
- `solved_mo3_last` → `solved_mo3_last_rank`（全球排名）、`solved_mo3_last_nr`（国家排名）

### 统计指标
每个成绩类型都包含多种统计指标：
- `*_mean` - 平均值
- `*_std` - 标准差
- `*_avg` - 去极值平均值
- `*_median` - 中位数
- `*_mode` - 众数
- `*_min` / `*_max` - 最小值/最大值
- `*_count` - 次数
- `*_nunique` - 唯一值数量
- `*_consecutive` - 连续次数

### 奖牌
- `gold` - 金牌数
- `silver` - 银牌数
- `bronze` - 铜牌数

### 滚动平均
- `solved_mo3/5/12/50/100_last` - Mean of 3/5/12/50/100 最后值
- `solved_mo3/5/12/50/100_best` - Mean of 3/5/12/50/100 最佳值
- `solved_ao5/12/50/100_last` - Average of 5/12/50/100 最后值
- `solved_ao5/12/50/100_best` - Average of 5/12/50/100 最佳值

## 使用技巧

### 列选择器使用
1. 点击"选择列..."按钮打开列选择面板
2. 按类别浏览和选择要显示的列
3. 使用分组标题旁的"全选"/"全不选"按钮快速选择整个类别
4. 点击"应用"按钮保存选择并更新表格
5. 每个文件的列选择设置会独立保存

### 文件切换
- 在控制面板顶部的"数据文件"下拉菜单中选择要查看的文件
- 页面会自动加载对应的 CSV 文件
- 列选择设置会按文件分别保存和恢复

### 排序和搜索
- 点击表头可以快速排序
- 使用排序下拉菜单选择排序字段和方式
- 在搜索框输入姓名可以实时过滤数据

## 技术栈

- **后端**: Julia + DataFrames + StatsBase + RollingFunctions
- **前端**: HTML5 + CSS3 + Vanilla JavaScript
- **数据格式**: CSV
- **存储**: LocalStorage（保存用户偏好设置）

## 性能优化

代码经过性能优化，包括：
- 预过滤数据减少重复遍历
- 使用 Set 加速查找操作
- 合并多次 groupby 操作
- 优化 CSV 解析和数据处理

## 许可证

查看 LICENSE 文件了解详情。